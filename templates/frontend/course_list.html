{% extends 'base.html' %}

{% block title %}Courses - French Tutor Hub{% endblock %}

{% block extra_css %}
<style>
    .course-card {
        transition: transform 0.3s, box-shadow 0.3s;
        height: 100%;
    }
    
    .course-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .course-img {
        height: 200px;
        object-fit: cover;
    }
    
    .course-level {
        position: absolute;
        top: 10px;
        right: 10px;
    }
    
    .filter-sidebar {
        position: sticky;
        top: 20px;
    }
    
    .search-form {
        position: relative;
    }
    
    .search-form .bi-search {
        position: absolute;
        top: 50%;
        left: 15px;
        transform: translateY(-50%);
        color: #6c757d;
    }
    
    .search-input {
        padding-left: 40px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <h1>Browse Courses</h1>
            <p class="lead">Find the perfect French course for your learning journey</p>
        </div>
    </div>

    <div class="row">
        <!-- Filters Sidebar -->
        <div class="col-lg-3 mb-4">
            <div class="card shadow-sm filter-sidebar">
                <div class="card-header bg-white">
                    <h5 class="mb-0">Filter Courses</h5>
                </div>
                <div class="card-body">
                    <form id="course-filter-form">
                        <div class="mb-3">
                            <label for="search-input" class="form-label">Search</label>
                            <div class="search-form">
                                <i class="bi bi-search"></i>
                                <input type="text" class="form-control search-input" id="search-input" placeholder="Search courses...">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="category-filter" class="form-label">Category</label>
                            <select class="form-select" id="category-filter">
                                <option value="">All Categories</option>
                                {% for category in categories %}
                                <option value="{{ category.id }}">{{ category.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="level-filter" class="form-label">Level</label>
                            <select class="form-select" id="level-filter">
                                <option value="">All Levels</option>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Price Range</label>
                            <div class="d-flex align-items-center">
                                <input type="number" class="form-control me-2" placeholder="Min" id="price-min">
                                <span>-</span>
                                <input type="number" class="form-control ms-2" placeholder="Max" id="price-max">
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-filter"></i> Apply Filters
                            </button>
                            <button type="reset" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-counterclockwise"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Courses List -->
        <div class="col-lg-9">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <span class="fw-bold" id="courses-count">0</span> courses found
                </div>
                <div class="d-flex align-items-center">
                    <label for="sort-select" class="me-2">Sort by:</label>
                    <select class="form-select form-select-sm" id="sort-select">
                        <option value="popular">Most Popular</option>
                        <option value="newest">Newest</option>
                        <option value="price_low">Price: Low to High</option>
                        <option value="price_high">Price: High to Low</option>
                        <option value="rating">Highest Rated</option>
                    </select>
                </div>
            </div>
            
            <!-- Loading Indicator -->
            <div id="courses-loading" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading courses...</p>
            </div>
            
            <!-- Courses Grid -->
            <div class="row g-4" id="course-list-container">
                <!-- Course cards will be dynamically inserted here -->
            </div>
            
            <!-- Pagination -->
            <nav class="mt-5" aria-label="Course pagination">
                <ul class="pagination justify-content-center" id="pagination-container">
                    <!-- Pagination will be dynamically inserted here -->
                </ul>
            </nav>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Reset button functionality
        const resetButton = document.querySelector('button[type="reset"]');
        if (resetButton) {
            resetButton.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Reset all form fields
                document.getElementById('search-input').value = '';
                document.getElementById('category-filter').selectedIndex = 0;
                document.getElementById('level-filter').selectedIndex = 0;
                document.getElementById('price-min').value = '';
                document.getElementById('price-max').value = '';
                
                // Reload courses with no filters
                loadCourseListings();
            });
        }
        
        // Sort select change handler
        const sortSelect = document.getElementById('sort-select');
        if (sortSelect) {
            sortSelect.addEventListener('change', function() {
                loadCourseListings();
            });
        }
    });
    
    // Function to update courses count
    function updateCoursesCount(count) {
        const countElement = document.getElementById('courses-count');
        if (countElement) {
            countElement.textContent = count;
        }
    }
    
    // Function to render course cards
    function renderCourseCard(course) {
        // Get level badge color
        let levelBadgeClass = 'bg-secondary';
        if (course.level) {
            switch(course.level.toLowerCase()) {
                case 'beginner':
                    levelBadgeClass = 'bg-success';
                    break;
                case 'intermediate':
                    levelBadgeClass = 'bg-info';
                    break;
                case 'advanced':
                    levelBadgeClass = 'bg-warning';
                    break;
            }
        }
        
        // Create course card HTML
        return `
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card h-100 shadow-sm course-card">
                    <img src="${course.image || '/static/images/course-default.jpg'}" class="card-img-top course-img" alt="${course.title}">
                    <div class="position-absolute course-level">
                        <span class="badge ${levelBadgeClass}">${course.level || 'All Levels'}</span>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">${course.title}</h5>
                        <p class="text-muted">
                            <i class="bi bi-person-circle"></i> ${course.teacher}
                        </p>
                        <p class="card-text">${course.description.length > 100 ? course.description.substring(0, 100) + '...' : course.description}</p>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <span class="h5 mb-0">â‚¬${course.price}</span>
                            <a href="/courses/${course.id}/" class="btn btn-sm btn-primary">View Course</a>
                        </div>
                    </div>
                    <div class="card-footer bg-white">
                        <div class="d-flex justify-content-between text-muted">
                            <small>
                                <i class="bi bi-calendar"></i> Added ${new Date(course.created_at).toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'})}
                            </small>
                            <small>
                                <i class="bi bi-tag"></i> ${course.category || 'Uncategorized'}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
</script>
{% endblock %}
